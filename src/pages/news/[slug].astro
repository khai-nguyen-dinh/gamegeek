---
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import Footer from '../../components/Footer.astro';
import newsData from '../../data/news.json';

// Get the slug from the URL params
export async function getStaticPaths() {
  const { posts, categories } = newsData;
  
  // Map category IDs to category names
  const categoryMap = new Map(categories.map(cat => [cat.id, cat.name]));
  
  // Transform posts to include category name
  const transformedPosts = posts.map(post => ({
    ...post,
    category: categoryMap.get(post.category) || post.category
  }));

  return transformedPosts.map((post) => ({
    params: { slug: post.slug },
    props: post
  }));
}

const { slug } = Astro.params;
const { title, date, category, author, image, thumb, thumb2, thumb3, breadcrumbBg, content } = Astro.props;

// Get all data for sidebar and related posts
const { posts, categories } = newsData;
const categoryMap = new Map(categories.map(cat => [cat.id, cat.name]));

// Get recent posts (exclude current post)
const allPosts = posts.map(post => ({
  ...post,
  category: categoryMap.get(post.category) || post.category
}));

const getDateTime = (value) => {
  if (!value || typeof value !== 'string') return 0;
  const parsed = new Date(value);
  return Number.isNaN(parsed.getTime()) ? 0 : parsed.getTime();
};

const recentPosts = allPosts
  .filter(post => post.slug !== slug)
  .sort((a, b) => getDateTime(b.date) - getDateTime(a.date))
  .slice(0, 3);

// Get related posts (same category, exclude current)
const relatedPosts = allPosts
  .filter(post => post.slug !== slug && post.category === category)
  .slice(0, 3);

// Count posts per category
const categoryCounts = new Map();
posts.forEach(post => {
  const catId = post.category;
  const count = categoryCounts.get(catId) || 0;
  categoryCounts.set(catId, count + 1);
});

// Extract day and month from date
const dateTime = getDateTime(date);
const displayDay = dateTime ? new Date(dateTime).getDate().toString().padStart(2, '0') : '';
const displayMonth = dateTime
  ? new Date(dateTime).toLocaleString('en-US', { month: 'short' })
  : '';
---

<Layout title={`${title} - GameGeek`}>
  <div id="smooth-content">
    <!-- Navbar Start -->
    <Navbar variant="white" />
    <!-- Navbar End -->

    <!-- Breadcrumb Section Start -->
    <div class="breadcrumb-area position-relative z-1">
      <img src="/renius/image/br-line-shape.png" alt="Shape" class="br-line-shape position-absolute top-0 start-0 w-100 h-100 z-n1">
      <img src="/renius/image/br-shape-1.png" alt="Shape" class="br-shape-one position-absolute z-n1 bounce">
      <img src="/renius/image/br-shape-2.png" alt="Shape" class="br-shape-two position-absolute bottom-0 z-n1 moveHorizontal">
      <div class="container-fluid px-xxl-5">
        <div class="row">
          <div class="col-md-10 offset-md-1 text-center">
            <h2 class="section-title style-one fw-black text-title">Blog Details</h2>
            <ul class="br-menu list-unstyled">
              <li><a href="/"><img src="/renius/image/home-icon.svg" alt="Icon">HOME</a></li>
              <li><a href="/news">BLOG</a></li>
              <li>BLOG DETAILS</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- Breadcrumb Section End -->

    <!-- Blog Details Start -->
    <div class="container ptb-120">
      <div class="row">
        <div class="col-xl-4 order-xl-1 order-2">
          <aside class="sidebar mt-lg-50">
            <div class="sidebar-widget search-widget bg-gray round-10">
              <form action="#" class="position-relative">
                <input type="search" placeholder="Search" class="w-100 bg-white border-0 round-10 text-para outline-0">
                <button class="position-absolute top-0 h-100 bg-transparent border-0"><i class="ri-search-line"></i></button>
              </form>
            </div>
            <div class="sidebar-widget category-widget bg-gray round-10">
              <h3 class="sidebar-widget-title fs-18 fw-semibold text-title mb-15">Categories</h3>
              <ul class="list-unstyled mb-0">
                {categories.map(cat => {
                  const count = categoryCounts.get(cat.id) || 0;
                  return (
                    <li>
                      <a href={`/news?category=${cat.slug}`} class="position-relative">
                        <i class="ri-arrow-right-s-line position-absolute"></i>
                        {cat.name} <span>({count})</span>
                      </a>
                    </li>
                  );
                })}
              </ul>
            </div>
            <div class="sidebar-widget category-widget bg-gray round-10">
              <h3 class="sidebar-widget-title fs-18 fw-semibold text-title mb-15">Recent Posts</h3>
              <div class="rp-post-wrap">
                {recentPosts.map(post => (
                  <div class="rp-post-card d-flex flex-wrap align-items-center">
                    <div class="rp-post-img">
                      <img src={post.thumb} alt="Post Thumb">
                    </div>
                    <div class="rp-post-info">
                      <a href={`/news/${post.slug}`} class="fs-15 fw-medium text_primary link-hover-primary d-block mb-1">{post.date}</a>
                      <h5 class="fs-15 fw-bold mb-0">
                        <a href={`/news/${post.slug}`} class="text-title hover-text-primary transition">{post.title}</a>
                      </h5>
                    </div>
                  </div>
                ))}
              </div>
            </div>
            <div class="sidebar-widget tags-widget bg-gray round-10">
              <h3 class="sidebar-widget-title fs-18 fw-semibold text-title mb-15">Tags</h3>
              <ul class="list-unstyled mb-0">
                <li><a href="/news">Business</a></li>
                <li><a href="/news">Development</a></li>
                <li><a href="/news">Design</a></li>
                <li><a href="/news">Marketing</a></li>
                <li><a href="/news">Real Estate</a></li>
              </ul>
            </div>
          </aside>
        </div>

        <div class="col-xl-8 order-xl-2 order-1">
          <div class="blog-desc">
            <h1 class="font-secondary mb-2">{title}</h1>
            <ul class="blog-metainfo list-unstyled mb-20">
              <li class="fs-15 d-inline-block position-relative">By <a href="/news">{author}</a></li>
              <li class="fs-15 d-inline-block position-relative">{category}</li>
            </ul>
            <div class="single-img position-relative round-10 mb-35">
              <img src={thumb} alt="Blog" class="round-10">
              <a href="/news" class="blog-date bg-white text-title position-absolute d-flex flex-column align-items-center justify-content-center round-10">
                <span class="font-secondary fs-24 fw-black d-block">{displayDay}</span>{displayMonth}
              </a>
            </div>
            <div class="single-para">
              {content ? (
                <Fragment set:html={content}></Fragment>
              ) : (
                <>
                  <h6>Overview & Challenge</h6>
                  <p>Renius Real Estate & Construction Group, we believe knowledge empowers better decisions—whether you're investing in property, managing a build, or exploring industry trends. Our blog is a dedicated space where we share expert insights, project highlights, market updates, and thought leadership on real estate and construction.</p>
                  <p>Whether you're a client, partner, or industry professional, you'll find valuable content that helps you stay informed and make smarter decisions in the world of real estate and construction.</p>
                  
                  {thumb2 && thumb3 && (
                    <div class="row justify-content-center mb-2 mt-4">
                      <div class="col-md-6">
                        <div class="single-img round-10 mb-30">
                          <img src={thumb2} alt="Image" class="round-10">
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="single-img round-10 mb-30">
                          <img src={thumb3} alt="Image" class="round-10">
                        </div>
                      </div>
                    </div>
                  )}
                  
                  <h6 class="mt-4">Worker Productivity due to Safety Concerns</h6>
                  <p>begins with a commitment to excellence. From initial planning to final handover, our team works with precision, transparency, and dedication to deliver spaces that serve both function and vision. Backed by years of industry expertise and a deep understanding build as an opportunity to shape communities</p>
                </>
              )}
            </div>
          </div>

          <div class="post-metaoption bg-white mb-40 round-15">
            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="post-tag d-flex fle-wrap align-items-center mb-sm-20">
                  <span class="text-title me-3">Tags</span>
                  <ul class="tag-list style-two list-unstyled mb-0">
                    <li><a href="/news">News</a>,</li>
                    <li><a href="/news">Business</a>,</li>
                    <li><a href="/news">{category}</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-md-6">
                <div class="post-share d-flex flex-wrap align-items-center justify-content-md-end">
                  <span class="text-para fw-semibold me-2">Share:</span>
                  <ul class="social-profile style-one list-unstyled mb-0">
                    <li><a href="https://www.facebook.com/" target="_blank" class="d-flex flex-column align-items-center justify-content-center rounded-circle"><i class="ri-facebook-fill"></i></a></li>
                    <li><a href="https://x.com/?lang=en" target="_blank" class="d-flex flex-column align-items-center justify-content-center rounded-circle"><i class="ri-twitter-x-line"></i></a></li>
                    <li><a href="https://www.instagram.com/" target="_blank" class="d-flex flex-column align-items-center justify-content-center rounded-circle"><i class="ri-instagram-line"></i></a></li>
                    <li><a href="https://www.linkedin.com/" target="_blank" class="d-flex flex-column align-items-center justify-content-center rounded-circle"><i class="ri-linkedin-fill"></i></a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          {relatedPosts.length > 0 && (
            <h4 class="fs-20 fw-bold text-title mb-25">Related Articles</h4>
          )}
          {relatedPosts.length > 0 && (
            <div class="row g-4 mb-50">
              {relatedPosts.map(post => (
                <div class="col-lg-4 col-md-6">
                  <article class="blog-card">
                    <div class="blog-thumb mb-3">
                      <img src={post.thumb} alt="Article" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
                    </div>
                    <div class="blog-meta text-sm text-gray-500 mb-2">
                      <span>{post.date}</span>
                    </div>
                    <h5>
                      <a href={`/news/${post.slug}`} class="text-title hover-text-primary transition">{post.title}</a>
                    </h5>
                  </article>
                </div>
              ))}
            </div>
          )}

          <h4 class="fs-20 fw-bold text-title mb-25">Comments (03)</h4>
          <div class="comment-item-wrap mb-50">
            <div class="comment-item d-flex flex-wrap">
              <div class="comment-author-img round-5">
                <img src="/renius/image/blog-10.jpg" alt="Image" class="round-5">
              </div>
              <div class="comment-author-info">
                <span class="fs-14 d-block mb-8">12 Jul, 2025</span>
                <h5 class="fs-16 fw-semibold font-primary text-title mb-10">Barret Simpson</h5>
                <p class="comment-text mb-8">Working with Renius was a game-changer for our commercial development. Their team was transparent, responsive, and incredibly detail-oriented throughout the entire process.</p>
                <a href="#cmt-form" class="reply-btn link style-one fw-medium">Reply</a>
              </div>
            </div>
            <div class="comment-item d-flex flex-wrap reply">
              <div class="comment-author-img round-5">
                <img src="/renius/image/blog-11.jpg" alt="Image" class="round-5">
              </div>
              <div class="comment-author-info">
                <span class="fs-14 d-block mb-8">13 Jul, 2025</span>
                <h5 class="fs-16 fw-semibold font-primary text-title mb-10">Parker Ballinger</h5>
                <p class="comment-text mb-8">The final result exceeded our expectations—delivered on time and on budget. We look forward to partnering with them again</p>
                <a href="#cmt-form" class="reply-btn link style-one fw-medium">Reply</a>
              </div>
            </div>
            <div class="comment-item d-flex flex-wrap">
              <div class="comment-author-img round-5">
                <img src="/renius/image/blog-12.jpg" alt="Image" class="round-5">
              </div>
              <div class="comment-author-info">
                <span class="fs-14 d-block mb-8">17 Jul, 2025</span>
                <h5 class="fs-16 fw-semibold font-primary text-title mb-10">Roan Atkinson</h5>
                <p class="comment-text mb-8">Renius was a game-changer for our commercial development. Their team was transparent, responsive, and incredibly detail-oriented throughout the entire process.</p>
                <a href="#cmt-form" class="reply-btn link style-one fw-medium">Reply</a>
              </div>
            </div>
          </div>

          <form action="#" class="comment-form bg-gray form-wrapper round-10" id="cmt-form">
            <h4 class="fs-20 fw-bold text-title mb-2">Leave A Comment</h4>
            <p class="mb-25">Your email address will not be published. Required fields are marked</p>
            <div class="row gx-xl-3">
              <div class="col-md-6">
                <div class="form-group position-relative mb-25">
                  <input type="text" required="" class="w-100 bg-white border-0 outline-0 round-5 text-para" placeholder="Name">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-25">
                  <input type="email" placeholder="Email" required="" class="w-100 ht-60 bg-white border-0 outline-0 round-5 text-para">
                </div>
              </div>
              <div class="col-12">
                <div class="form-group mb-25">
                  <textarea name="messages" id="messages" cols="30" rows="10" placeholder="Comment" class="w-100 ht-152 bg-white border-0 outline-0 round-5 text-para resize-0"></textarea>
                </div>
              </div>
              <div class="col-12">
                <div class="form-check checkbox style-one mb-25">
                  <input class="form-check-input" type="checkbox" id="test_2">
                  <label class="form-check-label" for="test_2">
                    Save my name, email, and website in this browser for the next time I comment.
                  </label>
                </div>
                <div class="col-xl-5 col-md-6">
                  <button class="btn style-one d-inline-flex flex-wrap align-items-center p-0">
                    <span class="btn-text d-inline-block fw-semibold position-relative transition">Post A Comment</span>
                    <span class="btn-icon position-relative d-flex flex-column align-items-center justify-content-center rounded-circle transition">
                      <i class="ri-arrow-right-up-line"></i>
                    </span>
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Blog Details End -->
  </div>
</Layout>
