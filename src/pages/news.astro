---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import newsData from '../data/news.json';
import { getContent, getContentObject } from '../utils/content.ts';

const newsContent = getContentObject('news');
const breadcrumb = newsContent?.breadcrumb || {};
const sidebar = newsContent?.sidebar || {};

// Get posts and categories from JSON
const { posts, categories } = newsData;

// Map category IDs to category names
const categoryMap = new Map(categories.map(cat => [cat.id, cat.name]));

// Transform posts to include category name and format date for display
const transformedPosts = posts.map(post => {
  const categoryName = categoryMap.get(post.category) || post.category;
  // Extract day and month from date string (e.g., "August 28, 2025" -> "28" and "Aug")
  const dateParts = post.date.split(' ');
  const day = dateParts[1]?.replace(',', '') || '';
  const month = dateParts[0]?.substring(0, 3) || '';
  
  return {
    ...post,
    category: categoryName,
    displayDay: day,
    displayMonth: month
  };
});

// Sort posts by date (newest first) - simple string comparison
const sortedPosts = [...transformedPosts].sort((a, b) => {
  return new Date(b.date).getTime() - new Date(a.date).getTime();
});

// Get recent posts (first 3)
const recentPosts = sortedPosts.slice(0, 3);

// Split posts for new layout:
// - Featured post (News 1): first post
// - Two rows of 2 posts each (News 2): posts 2-5
// - Three vertical posts (3): posts 6-8
const featuredPost = sortedPosts[0];
const twoByTwoPosts = sortedPosts.slice(1, 5); // Posts 2-5
const verticalPosts = sortedPosts.slice(5, 8); // Posts 6-8

// Count posts per category
const categoryCounts = new Map();
posts.forEach(post => {
  const count = categoryCounts.get(post.category) || 0;
  categoryCounts.set(post.category, count + 1);
});
---

<Layout title="Blog Left Sidebar | GameGeek">

<!-- Custom Cursor -->
<div class="cursor"><span class="cursor-text"></span></div>
<div class="cursor-inner"></div>

<div id="smooth-wrapper">
  <div id="smooth-content">
    <!-- Navbar Start -->
    <Navbar variant="white" />
    <!-- Navbar End -->

    <!-- Breadcrumb Section Start -->
    <div class="breadcrumb-area position-relative z-1">
      <img src="/renius/image/br-line-shape.png" alt="Shape" class="br-line-shape position-absolute top-0 start-0 w-100 h-100 z-n1">
      <img src="/renius/image/br-shape-1.png" alt="Shape" class="br-shape-one position-absolute z-n1 bounce">
      <img src="/renius/image/br-shape-2.png" alt="Shape" class="br-shape-two position-absolute bottom-0 z-n1 moveHorizontal">
      <div class="container-fluid px-xxl-5">
        <div class="row">
          <div class="col-md-10 offset-md-1 text-center">
            <h2 class="section-title style-one fw-black text-title">{breadcrumb.title || 'NEWS & INSIGHTS'}</h2>
            <ul class="br-menu list-unstyled">
              <li><a href="/"><img src="/renius/image/home-icon.svg" alt="Icon">{breadcrumb.home || 'HOME'}</a></li>
              <li>{breadcrumb.current || 'BLOG'}</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- Breadcrumb Section End -->

    <!-- Blog Section Start -->
    <div class="container ptb-120">
      <div class="row">
        <div class="col-xl-4 order-xl-1 order-2">
          <aside class="sidebar mt-lg-50">
            <div class="sidebar-widget search-widget bg-gray round-10">
              <form action="#" class="position-relative">
                <input type="search" placeholder={sidebar.search?.placeholder || 'Search'} class="w-100 bg-white border-0 round-10 text-para outline-0">
                <button class="position-absolute top-0 h-100 bg-transparent border-0"><i class="ri-search-line"></i></button>
              </form>
            </div>
            <div class="sidebar-widget category-widget bg-gray round-10">
              <h3 class="sidebar-widget-title fs-18 fw-semibold text-title mb-15">{sidebar.categories?.title || 'Categories'}</h3>
              <ul class="list-unstyled mb-0">
                {categories.map(cat => {
                  const count = categoryCounts.get(cat.id) || 0;
                  return (
                    <li>
                      <a href={`/news?category=${cat.slug}`} class="position-relative">
                        <i class="ri-arrow-right-s-line position-absolute"></i>
                        {cat.name} <span>({count})</span>
                      </a>
                    </li>
                  );
                })}
              </ul>
            </div>
            <div class="sidebar-widget category-widget bg-gray round-10">
              <h3 class="sidebar-widget-title fs-18 fw-semibold text-title mb-15">{sidebar.recentPosts?.title || 'Recent Posts'}</h3>
              <div class="rp-post-wrap">
                {recentPosts.map(post => (
                  <div class="rp-post-card d-flex flex-wrap align-items-center">
                    <div class="rp-post-img">
                      <img src={post.thumb} alt="Post Thumb">
                    </div>
                    <div class="rp-post-info">
                      <a href={`/news/${post.slug}`} class="fs-15 fw-medium text_primary link-hover-primary d-block mb-1">{post.date}</a>
                      <h5 class="fs-15 fw-bold mb-0">
                        <a href={`/news/${post.slug}`} class="text-title hover-text-primary transition">{post.title}</a>
                      </h5>
                    </div>
                  </div>
                ))}
              </div>
            </div>
            <div class="sidebar-widget tags-widget bg-gray round-10">
              <h3 class="sidebar-widget-title fs-18 fw-semibold text-title mb-15">{sidebar.tags?.title || 'Tags'}</h3>
              <ul class="list-unstyled mb-0">
                {(sidebar.tags?.items || ['Business', 'Development', 'Design', 'Marketing', 'Real Estate']).map((tag) => (
                  <li><a href="#">{tag}</a></li>
                ))}
              </ul>
            </div>
          </aside>
        </div>

        <div class="col-xl-8 order-xl-2 order-1">
          <!-- Featured Post (News 1) - Large Box -->
          {featuredPost && (
            <div class="mb-40">
              <div class="blog-card style-one position-relative">
                <div class="blog-img position-relative overflow-hidden round-20">
                  <img src={featuredPost.thumb} alt="Blog" class="round-20 w-100" style="height: 400px; object-fit: cover;">
                  <a href={`/news/${featuredPost.slug}`} class="blog-date bg-white text-title position-absolute d-flex flex-column align-items-center justify-content-center round-10">
                    <span class="font-secondary fs-24 fw-black d-block">{featuredPost.displayDay}</span> {featuredPost.displayMonth}
                  </a>
                </div>
                <ul class="blog-metainfo list-unstyled mt-3">
                  <li class="fs-15 d-inline-block position-relative">By <a href="#">{featuredPost.author}</a></li>
                  <li class="fs-15 d-inline-block position-relative">{featuredPost.category}</li>
                </ul>
                <h3 class="fs-28 fw-black mt-2">
                  <a href={`/news/${featuredPost.slug}`} class="text-title link-hover-primary fw-bold transition">{featuredPost.title}</a>
                </h3>
                <a href={`/news/${featuredPost.slug}`} class="link style-one fw-semibold">{newsContent.readMore || 'Read More'}<img src="/renius/image/right-arrow-small.svg" alt="Icon"></a>
              </div>
            </div>
          )}

          <!-- Two Rows of 2 Posts Each (News 2) -->
          {twoByTwoPosts.length > 0 && (
            <>
              {/* First Row - 2 Posts */}
              <div class="row mb-30">
                {twoByTwoPosts.slice(0, 2).map(post => (
                  <div class="col-md-6">
                    <div class="blog-card style-one position-relative mb-30">
                      <div class="blog-img position-relative overflow-hidden round-20">
                        <img src={post.thumb} alt="Blog" class="round-20 w-100" style="height: 280px; object-fit: cover;">
                        <a href={`/news/${post.slug}`} class="blog-date bg-white text-title position-absolute d-flex flex-column align-items-center justify-content-center round-10">
                          <span class="font-secondary fs-24 fw-black d-block">{post.displayDay}</span> {post.displayMonth}
                        </a>
                      </div>
                      <ul class="blog-metainfo list-unstyled">
                        <li class="fs-15 d-inline-block position-relative">By <a href="#">{post.author}</a></li>
                        <li class="fs-15 d-inline-block position-relative">{post.category}</li>
                      </ul>
                      <h3 class="fs-24 fw-black">
                        <a href={`/news/${post.slug}`} class="text-title link-hover-primary fw-bold transition">{post.title}</a>
                      </h3>
                      <a href={`/news/${post.slug}`} class="link style-one fw-semibold">Read More<img src="/renius/image/right-arrow-small.svg" alt="Icon"></a>
                    </div>
                  </div>
                ))}
              </div>

              {/* Second Row - 2 Posts */}
              <div class="row mb-30">
                {twoByTwoPosts.slice(2, 4).map(post => (
                  <div class="col-md-6">
                    <div class="blog-card style-one position-relative mb-30">
                      <div class="blog-img position-relative overflow-hidden round-20">
                        <img src={post.thumb} alt="Blog" class="round-20 w-100" style="height: 280px; object-fit: cover;">
                        <a href={`/news/${post.slug}`} class="blog-date bg-white text-title position-absolute d-flex flex-column align-items-center justify-content-center round-10">
                          <span class="font-secondary fs-24 fw-black d-block">{post.displayDay}</span> {post.displayMonth}
                        </a>
                      </div>
                      <ul class="blog-metainfo list-unstyled">
                        <li class="fs-15 d-inline-block position-relative">By <a href="#">{post.author}</a></li>
                        <li class="fs-15 d-inline-block position-relative">{post.category}</li>
                      </ul>
                      <h3 class="fs-24 fw-black">
                        <a href={`/news/${post.slug}`} class="text-title link-hover-primary fw-bold transition">{post.title}</a>
                      </h3>
                      <a href={`/news/${post.slug}`} class="link style-one fw-semibold">Read More<img src="/renius/image/right-arrow-small.svg" alt="Icon"></a>
                    </div>
                  </div>
                ))}
              </div>
            </>
          )}

          <!-- Three Vertical Posts (3) - Long Narrow Boxes -->
          {verticalPosts.length > 0 && (
            <div class="vertical-posts">
              {verticalPosts.map(post => (
                <div class="blog-card style-one position-relative mb-30 d-flex flex-row align-items-center">
                  <div class="blog-img position-relative overflow-hidden round-20 me-3" style="width: 200px; min-width: 200px; height: 150px;">
                    <img src={post.thumb} alt="Blog" class="round-20 w-100 h-100" style="object-fit: cover;">
                    <a href={`/news/${post.slug}`} class="blog-date bg-white text-title position-absolute d-flex flex-column align-items-center justify-content-center round-10">
                      <span class="font-secondary fs-20 fw-black d-block">{post.displayDay}</span> {post.displayMonth}
                    </a>
                  </div>
                  <div class="blog-content flex-grow-1">
                    <ul class="blog-metainfo list-unstyled">
                      <li class="fs-15 d-inline-block position-relative">By <a href="#">{post.author}</a></li>
                      <li class="fs-15 d-inline-block position-relative">{post.category}</li>
                    </ul>
                    <h3 class="fs-20 fw-black mb-2">
                      <a href={`/news/${post.slug}`} class="text-title link-hover-primary fw-bold transition">{post.title}</a>
                    </h3>
                    <a href={`/news/${post.slug}`} class="link style-one fw-semibold">Read More<img src="/renius/image/right-arrow-small.svg" alt="Icon"></a>
                  </div>
                </div>
              ))}
            </div>
          )}

          <!-- Remaining Posts (if any) -->
          {sortedPosts.length > 8 && (
            <div class="row justify-content-center mt-4">
              {sortedPosts.slice(8).map(post => (
                <div class="col-md-6">
                  <div class="blog-card style-one position-relative mb-30">
                    <div class="blog-img position-relative overflow-hidden round-20">
                      <img src={post.thumb} alt="Blog" class="round-20">
                      <a href={`/news/${post.slug}`} class="blog-date bg-white text-title position-absolute d-flex flex-column align-items-center justify-content-center round-10">
                        <span class="font-secondary fs-24 fw-black d-block">{post.displayDay}</span> {post.displayMonth}
                      </a>
                    </div>
                    <ul class="blog-metainfo list-unstyled">
                      <li class="fs-15 d-inline-block position-relative">By <a href="#">{post.author}</a></li>
                      <li class="fs-15 d-inline-block position-relative">{post.category}</li>
                    </ul>
                    <h3 class="fs-24 fw-black">
                      <a href={`/news/${post.slug}`} class="text-title link-hover-primary fw-bold transition">{post.title}</a>
                    </h3>
                    <a href={`/news/${post.slug}`} class="link style-one fw-semibold">Read More<img src="/renius/image/right-arrow-small.svg" alt="Icon"></a>
                  </div>
                </div>
              ))}
            </div>
          )}
          <ul class="page-nav pagination justify-content-center mb-0 mt-lg-4">
            <li class="page-item">
              <a class="page-link d-flex flex-column align-items-center justify-content-center rounded-circle" href="#" aria-label="Previous">
                <i class="ri-arrow-left-line"></i>
              </a>
            </li>
            <li class="page-item"><a class="page-link d-flex flex-column align-items-center justify-content-center rounded-circle active" href="#">01</a></li>
            <li class="page-item"><a class="page-link d-flex flex-column align-items-center justify-content-center rounded-circle" href="#">02</a></li>
            <li class="page-item"><a class="page-link d-flex flex-column align-items-center justify-content-center rounded-circle" href="#">03</a></li>
            <li class="page-item">
              <a class="page-link d-flex flex-column align-items-center justify-content-center rounded-circle" href="#" aria-label="Next">
                <i class="ri-arrow-right-line"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Blog Details End -->

    <!-- Footer Section Start -->
    <Footer />
    <!-- Footer End -->

  </div>
</div>

</Layout>
