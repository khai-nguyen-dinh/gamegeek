---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Login - CMS | GameGeek">
  <div style="min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; padding: 2rem;">
    <div style="background: white; padding: 3rem; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); max-width: 450px; width: 100%;">
      <div style="text-align: center; margin-bottom: 2rem;">
        <h1 style="margin: 0 0 0.5rem 0; color: #333; font-size: 2rem; font-weight: bold;">CMS Login</h1>
        <p style="margin: 0; color: #666; font-size: 1rem;">Đăng nhập để truy cập CMS</p>
      </div>

      <form id="login-form" style="display: flex; flex-direction: column; gap: 1.5rem;">
        <div>
          <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 600; font-size: 0.95rem;">Username</label>
          <input 
            type="text" 
            id="username" 
            required 
            autocomplete="username"
            style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1rem; transition: border-color 0.3s; box-sizing: border-box;"
            placeholder="Nhập username"
          />
        </div>

        <div>
          <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 600; font-size: 0.95rem;">Password</label>
          <input 
            type="password" 
            id="password" 
            required 
            autocomplete="current-password"
            style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1rem; transition: border-color 0.3s; box-sizing: border-box;"
            placeholder="Nhập password"
          />
        </div>

        <div id="error-message" style="display: none; padding: 0.75rem; background: #fee; border: 1px solid #fcc; border-radius: 6px; color: #c33; font-size: 0.9rem;"></div>

        <button 
          type="submit" 
          style="padding: 0.875rem; border: none; background: #FF5E14; color: white; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: background 0.3s;"
          onmouseover="this.style.background='#e54e0f'"
          onmouseout="this.style.background='#FF5E14'"
        >
          Đăng nhập
        </button>
      </form>
    </div>
  </div>

  <script>
    // Get default credentials from localStorage or use defaults
    function getDefaultCredentials() {
      const stored = localStorage.getItem('cms_credentials');
      if (stored) {
        try {
          return JSON.parse(stored);
        } catch (e) {
          console.error('Error parsing stored credentials:', e);
        }
      }
      // Default credentials (should be changed on first login)
      return {
        username: 'admin',
        password: 'admin123'
      };
    }

    // Check if user is already logged in
    if (localStorage.getItem('cms_authenticated') === 'true') {
      window.location.href = '/admin/cms';
    }

    document.getElementById('login-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const errorDiv = document.getElementById('error-message');
      
      // Get credentials
      const credentials = getDefaultCredentials();
      
      // Validate
      if (username === credentials.username && password === credentials.password) {
        // Set authentication
        localStorage.setItem('cms_authenticated', 'true');
        localStorage.setItem('cms_username', username);
        localStorage.setItem('cms_login_time', Date.now().toString());
        
        // Redirect to CMS
        window.location.href = '/admin/cms';
      } else {
        errorDiv.textContent = 'Username hoặc password không đúng!';
        errorDiv.style.display = 'block';
        
        // Clear password field
        document.getElementById('password').value = '';
      }
    });

    // Focus on username field
    document.getElementById('username').focus();
  </script>
</Layout>
